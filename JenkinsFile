pipeline {
  agent any 
	tools {
		maven 'MAVEN_HOME'
		jdk 'JAVA_HOME'
		git 'Default'
	}
    stages {
	
      stage('SCM-Checkout') {
		steps {
		withCredentials([usernamePassword(credentialsId: 'MAHENDRAN_GIT_CLONE', passwordVariable: 'Jaddu@12345', usernameVariable: 'kgmahendran')])
 
          		echo "Cloning the source from github"
		  git branch: 'master', credentialsId: 'MAHENDRAN_GIT_CLONE', url: 'https://github.com/kgmahendran/Jenkins-Pipeline.git'
			}
		}
		
		stage ('Maven-Build') {
			steps {
				echo "Run the Maven command to build the application"
				bat label: '', script: 'mvn clean install'
			}		
		}
		
		stage ('Artifcatory-Upload') {
			steps {
				rtUpload (
					serverId: 'central',
					spec: '''{
						"files": [
										{
										"pattern": "target/*.war",
										"target": "Demo-Upload/$JOB_NAME/$BUILD_NUMBER/"
										}
									]
								}''',
								buildName: 'Pipeline-Groovy'
							)
					}
			}
	}
	
		post {
		always {
		archiveArtifacts artifacts: 'target/*.war', followSymlinks: false, onlyIfSuccessful: true, fingerprint: true
			}
		}
}
  
